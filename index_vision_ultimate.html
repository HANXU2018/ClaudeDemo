<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÂô™Èü≥ - Vision Ultimate</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        :root {
            --primary: #0066FF;
            --secondary: #00D4AA;
            --accent: #FF3B7D;
            --background: #0A0A0A;
            --surface: rgba(255, 255, 255, 0.02);
            --border: rgba(255, 255, 255, 0.05);
            --text-primary: rgba(255, 255, 255, 0.98);
            --text-secondary: rgba(255, 255, 255, 0.65);
            --glow: rgba(0, 102, 255, 0.6);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: relative;
            cursor: none;
        }

        /* ÊµÅ‰ΩìËÉåÊôØÁ≥ªÁªü */
        .fluid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 102, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 59, 125, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0A0A0A 0%, #0F0F0F 50%, #0A0A0A 100%);
            animation: fluid-motion 20s ease-in-out infinite;
        }

        @keyframes fluid-motion {
            0%, 100% { 
                background-position: 0% 50%;
                transform: scale(1);
            }
            25% { 
                background-position: 25% 25%;
                transform: scale(1.02);
            }
            50% { 
                background-position: 100% 50%;
                transform: scale(1);
            }
            75% { 
                background-position: 75% 75%;
                transform: scale(1.01);
            }
        }

        /* ‰∏ªÂ∫îÁî®ÂÆπÂô® */
        .app-shell {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* È°∂Â±ÇÁïåÈù¢ */
        .interface-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .status-rail {
            position: absolute;
            top: 60px;
            right: 60px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: all;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        .status-indicator.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 
                0 0 20px rgba(0, 102, 255, 0.4),
                0 0 40px rgba(0, 102, 255, 0.2);
            animation: status-pulse 2s ease-in-out infinite;
        }

        @keyframes status-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
        }

        .time-capsule {
            position: absolute;
            top: 60px;
            left: 60px;
            font-size: 2.2em;
            font-weight: 200;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            opacity: 0.9;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .date-subtitle {
            font-size: 0.35em;
            font-weight: 300;
            margin-top: 8px;
            opacity: 0.7;
            letter-spacing: 0.05em;
        }

        /* ‰∏≠Â§ÆÊéßÂà∂Ê†∏ÂøÉ */
        .control-nexus {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 40px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: all;
        }

        .nexus-core {
            position: absolute;
            width: 160px;
            height: 160px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50%;
            backdrop-filter: blur(24px);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .nexus-core:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 16px 64px rgba(0, 0, 0, 0.2),
                0 0 80px rgba(0, 102, 255, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        .nexus-core.playing {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.08), rgba(0, 212, 170, 0.08));
            border-color: rgba(0, 102, 255, 0.2);
            box-shadow: 
                0 20px 80px rgba(0, 102, 255, 0.2),
                0 0 120px rgba(0, 102, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: nexus-breathe 4s ease-in-out infinite;
        }

        @keyframes nexus-breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .sound-avatar {
            font-size: 3.5em;
            margin-bottom: 8px;
            transition: all 0.4s ease;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
        }

        .nexus-core.playing .sound-avatar {
            animation: avatar-levitate 6s ease-in-out infinite;
        }

        @keyframes avatar-levitate {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .sound-label {
            font-size: 0.85em;
            font-weight: 400;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
            text-align: center;
        }

        /* ËΩ®ÈÅìÁ≥ªÁªü */
        .orbit-system {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .orbit-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 1px solid rgba(255, 255, 255, 0.04);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .orbit-inner {
            width: 200px;
            height: 200px;
            animation: orbit-slow 25s linear infinite;
        }

        .orbit-outer {
            width: 260px;
            height: 260px;
            animation: orbit-slow 35s linear infinite reverse;
        }

        @keyframes orbit-slow {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .nexus-core.playing .orbit-ring {
            border-color: rgba(0, 102, 255, 0.1);
        }

        /* Â∫ïÈÉ®ÊéßÂà∂Âè∞ */
        .control-dock {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 48px;
            backdrop-filter: blur(24px);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            gap: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            pointer-events: all;
        }

        .session-timer {
            font-size: 1.1em;
            font-weight: 300;
            color: var(--text-primary);
            letter-spacing: -0.01em;
            min-width: 90px;
            text-align: center;
        }

        .volume-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .volume-icon {
            font-size: 1.1em;
            color: var(--text-secondary);
        }

        .volume-rail {
            width: 80px;
            height: 3px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .volume-thumb {
            position: absolute;
            top: -6px;
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 102, 255, 0.3);
        }

        .volume-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 16px rgba(0, 102, 255, 0.4);
        }

        /* Èü≥È¢ëÂ∫ìÁïåÈù¢ */
        .audio-vault {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(40px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 100px 60px 60px;
        }

        .audio-vault.visible {
            opacity: 1;
            visibility: visible;
        }

        .vault-header {
            font-size: 2.8em;
            font-weight: 200;
            margin-bottom: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-flow 8s ease-in-out infinite;
            text-align: center;
            letter-spacing: -0.02em;
        }

        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 50% 0%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 100%; }
        }

        .audio-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        .audio-tile {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px 24px;
            text-align: center;
            cursor: pointer;
            backdrop-filter: blur(24px);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .audio-tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            transition: left 0.8s ease;
        }

        .audio-tile:hover::before {
            left: 100%;
        }

        .audio-tile:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
        }

        .audio-tile.active {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.1), rgba(0, 212, 170, 0.1));
            border-color: rgba(0, 102, 255, 0.3);
            box-shadow: 0 16px 48px rgba(0, 102, 255, 0.2);
            transform: translateY(-4px);
        }

        .tile-icon {
            font-size: 3.2em;
            margin-bottom: 16px;
            display: block;
            transition: all 0.4s ease;
        }

        .audio-tile:hover .tile-icon {
            transform: scale(1.1) rotateY(15deg);
        }

        .tile-title {
            font-size: 1.1em;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }

        .tile-meta {
            font-size: 0.85em;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .vault-close {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 48px;
            height: 48px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50%;
            backdrop-filter: blur(24px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.4em;
            color: var(--text-secondary);
        }

        .vault-close:hover {
            background: rgba(255, 59, 125, 0.1);
            border-color: rgba(255, 59, 125, 0.3);
            color: var(--accent);
            transform: rotate(90deg) scale(1.1);
        }

        /* ÊâãÂäøÊèêÁ§∫Á≥ªÁªü */
        .gesture-guide {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            line-height: 1.8;
            animation: guide-breathe 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes guide-breathe {
            0%, 20%, 80%, 100% { opacity: 0.4; }
            40%, 60% { opacity: 0.6; }
        }

        /* Á≤íÂ≠êÂú∫ */
        .particle-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 1px;
            height: 1px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: particle-float 12s linear infinite;
        }

        @keyframes particle-float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .control-nexus {
                width: 240px;
                height: 240px;
            }
            
            .nexus-core {
                width: 140px;
                height: 140px;
            }
            
            .sound-avatar {
                font-size: 2.8em;
            }
            
            .time-capsule {
                font-size: 1.8em;
                top: 40px;
                left: 40px;
            }
            
            .status-rail {
                top: 40px;
                right: 40px;
            }
            
            .audio-matrix {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 16px;
            }
            
            .vault-header {
                font-size: 2.2em;
                margin-bottom: 40px;
            }
        }

        /* È´òÁ∫ßËß¶ËßâÂèçÈ¶à */
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(0, 102, 255, 0.1);
            transform: scale(0);
            animation: ripple-expand 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple-expand {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Èü≥È¢ëÂèØËßÜÂåñ */
        .visualizer-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div class="fluid-background"></div>
    <div class="particle-field" id="particleField"></div>

    <div class="app-shell">
        <!-- ÁïåÈù¢Âè†Âä†Â±Ç -->
        <div class="interface-overlay">
            <div class="time-capsule" id="timeCapsule">
                <div id="timeDisplay">--:--</div>
                <div class="date-subtitle" id="dateDisplay">---- -- --</div>
            </div>
            
            <div class="status-rail">
                <div class="status-indicator" id="playStatus"></div>
                <div class="status-indicator" id="sessionStatus"></div>
            </div>
        </div>

        <!-- ‰∏≠Â§ÆÊéßÂà∂Ê†∏ÂøÉ -->
        <div class="control-nexus">
            <div class="orbit-system">
                <div class="orbit-ring orbit-inner"></div>
                <div class="orbit-ring orbit-outer"></div>
            </div>
            
            <div class="nexus-core" id="nexusCore">
                <span class="sound-avatar" id="soundAvatar">üì∫</span>
                <div class="sound-label" id="soundLabel">Êñ∞ÈóªÊí≠Êä•</div>
            </div>
            
            <canvas class="visualizer-canvas" id="visualizerCanvas"></canvas>
        </div>

        <!-- Â∫ïÈÉ®ÊéßÂà∂Âè∞ -->
        <div class="control-dock">
            <div class="session-timer" id="sessionTimer">00:00:00</div>
            <div class="volume-section">
                <span class="volume-icon">üîä</span>
                <div class="volume-rail" id="volumeRail">
                    <div class="volume-thumb" id="volumeThumb"></div>
                </div>
            </div>
        </div>

        <!-- ÊâãÂäøÊåáÂçó -->
        <div class="gesture-guide">
            ËΩªËß¶Êí≠ÊîæÊöÇÂÅú ¬∑ ÂèåÂáªÈü≥È¢ëÂ∫ì ¬∑ ÊªëÂä®ÂàáÊç¢ ¬∑ ÈïøÊåâÈü≥Èáè
        </div>
    </div>

    <!-- Èü≥È¢ëÂ∫ì -->
    <div class="audio-vault" id="audioVault">
        <div class="vault-close" id="vaultClose">√ó</div>
        <div class="vault-header">AUDIO VAULT</div>
        <div class="audio-matrix" id="audioMatrix">
            <!-- Âä®ÊÄÅÁîüÊàê -->
        </div>
    </div>

    <script>
        const sounds = [
            { id: 'news', title: 'Êñ∞ÈóªÊí≠Êä•', icon: 'üì∫', url: './audio/news.mp3', duration: '7:17' },
            { id: 'xiaozhang', title: 'È¢ÜÂØºËÆ≤ËØù', icon: 'üé§', url: './audio/xiaozhang.mp3', duration: '9:02' },
            { id: 'white_noise', title: 'ÁôΩÂô™Èü≥', icon: 'üìª', url: './audio/white_noise.mp3', duration: '1:00' },
            { id: 'pink_noise', title: 'Á≤âÂô™Èü≥', icon: 'üå∏', url: './audio/pink_noise.mp3', duration: '1:00' },
            { id: 'brown_noise', title: 'Ê£ïÂô™Èü≥', icon: 'ü§é', url: './audio/brown_noise.mp3', duration: '1:00' },
            { id: 'rain', title: 'Èõ®Â£∞', icon: 'üåßÔ∏è', url: './audio/rain.mp3', duration: '1:00' },
            { id: 'ocean', title: 'Êµ∑Êµ™', icon: 'üåä', url: './audio/ocean_waves.mp3', duration: '1:00' },
            { id: 'birds', title: 'È∏üÈ∏£', icon: 'üê¶', url: './audio/birds_chirping.mp3', duration: '1:00' },
            { id: 'fire', title: 'ÁÅ´ÁÑ∞', icon: 'üî•', url: './audio/fireplace.mp3', duration: '1:00' }
        ];

        // Â∫îÁî®Áä∂ÊÄÅ
        let currentIndex = 0;
        let currentAudio = null;
        let audioContext = null;
        let analyser = null;
        let dataArray = null;
        let volume = 50;
        let isPlaying = false;
        let sessionStartTime = Date.now();
        let totalPlayTime = 0;
        
        // ‰∫§‰∫íÁä∂ÊÄÅ
        let touchStartPos = null;
        let longPressTimer = null;
        let tapTimer = null;
        let tapCount = 0;

        // CanvasÂèØËßÜÂåñ
        let canvas, ctx;
        let animationId;

        // ÂàùÂßãÂåñÂ∫îÁî®
        function init() {
            setupCanvas();
            setupAudioContext();
            setupParticles();
            loadSound(currentIndex);
            initGestures();
            initTimers();
            renderAudioMatrix();
            startVisualization();

            // 3ÁßíÂêéËá™Âä®Êí≠Êîæ
            setTimeout(() => {
                playCurrentSound();
            }, 3000);
        }

        // ËÆæÁΩÆCanvas
        function setupCanvas() {
            canvas = document.getElementById('visualizerCanvas');
            ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio;
                canvas.height = rect.height * window.devicePixelRatio;
                ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        }

        // ËÆæÁΩÆÈü≥È¢ë‰∏ä‰∏ãÊñá
        function setupAudioContext() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 64;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
            } catch (e) {
                console.warn('Web Audio API not supported');
            }
        }

        // ËÆæÁΩÆÁ≤íÂ≠êÁ≥ªÁªü
        function setupParticles() {
            const particleField = document.getElementById('particleField');
            
            function createParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * window.innerWidth + 'px';
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animationDuration = (8 + Math.random() * 8) + 's';
                particleField.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                }, 12000);
            }
            
            // ÂàõÂª∫ÂàùÂßãÁ≤íÂ≠ê
            for (let i = 0; i < 15; i++) {
                setTimeout(() => createParticle(), Math.random() * 3000);
            }
            
            // ÊåÅÁª≠ÂàõÂª∫Á≤íÂ≠ê
            setInterval(createParticle, 1200);
        }

        // Âä†ËΩΩÈü≥È¢ë
        function loadSound(index) {
            const sound = sounds[index];
            
            // Êõ¥Êñ∞UI
            document.getElementById('soundAvatar').textContent = sound.icon;
            document.getElementById('soundLabel').textContent = sound.title;
            
            // ÂÅúÊ≠¢ÂΩìÂâçÈü≥È¢ë
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // ÂàõÂª∫Êñ∞Èü≥È¢ë
            currentAudio = new Audio(sound.url);
            currentAudio.loop = true;
            currentAudio.volume = volume / 100;
            currentAudio.crossOrigin = 'anonymous';
            
            // ËøûÊé•Èü≥È¢ëÂàÜÊûêÂô®
            if (audioContext && analyser) {
                try {
                    const source = audioContext.createMediaElementSource(currentAudio);
                    source.connect(analyser);
                    analyser.connect(audioContext.destination);
                } catch (e) {
                    console.warn('Audio context connection failed:', e);
                }
            }
            
            // Èü≥È¢ë‰∫ã‰ª∂ÁõëÂê¨
            currentAudio.onplay = () => {
                isPlaying = true;
                updatePlayingState();
                
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            };
            
            currentAudio.onpause = () => {
                isPlaying = false;
                updatePlayingState();
            };
            
            updateAudioMatrix();
        }

        // Êí≠ÊîæÈü≥È¢ë
        async function playCurrentSound() {
            if (!currentAudio) return;
            
            try {
                await currentAudio.play();
            } catch (error) {
                console.warn('Êí≠ÊîæÂ§±Ë¥•:', error);
            }
        }

        // ÂàáÊç¢Êí≠ÊîæÁä∂ÊÄÅ
        function togglePlay() {
            if (!currentAudio) return;
            
            if (isPlaying) {
                currentAudio.pause();
            } else {
                playCurrentSound();
            }
        }

        // ÂàáÊç¢Èü≥È¢ë
        function switchSound(direction) {
            if (direction > 0) {
                currentIndex = (currentIndex + 1) % sounds.length;
            } else {
                currentIndex = (currentIndex - 1 + sounds.length) % sounds.length;
            }
            
            const wasPlaying = isPlaying;
            loadSound(currentIndex);
            
            if (wasPlaying) {
                setTimeout(() => playCurrentSound(), 100);
            }
        }

        // ËÆæÁΩÆÈü≥Èáè
        function setVolume(newVolume) {
            volume = Math.max(0, Math.min(100, newVolume));
            
            if (currentAudio) {
                currentAudio.volume = volume / 100;
            }
            
            updateVolumeDisplay();
        }

        // Êõ¥Êñ∞Èü≥ÈáèÊòæÁ§∫
        function updateVolumeDisplay() {
            const thumb = document.getElementById('volumeThumb');
            const position = (volume / 100) * 65; // 65pxÊòØËΩ®ÈÅìÂÆΩÂ∫¶ÂáèÂéªÊãáÊåáÂÆΩÂ∫¶ÁöÑ‰∏ÄÂçä
            thumb.style.left = position + 'px';
        }

        // Êõ¥Êñ∞Êí≠ÊîæÁä∂ÊÄÅ
        function updatePlayingState() {
            const nexusCore = document.getElementById('nexusCore');
            const playStatus = document.getElementById('playStatus');
            const sessionStatus = document.getElementById('sessionStatus');
            
            if (isPlaying) {
                nexusCore.classList.add('playing');
                playStatus.classList.add('active');
                sessionStatus.classList.add('active');
            } else {
                nexusCore.classList.remove('playing');
                playStatus.classList.remove('active');
                sessionStatus.classList.remove('active');
            }
        }

        // Ê∏≤ÊüìÈü≥È¢ëÁü©Èòµ
        function renderAudioMatrix() {
            const matrix = document.getElementById('audioMatrix');
            matrix.innerHTML = sounds.map((sound, index) => `
                <div class="audio-tile ${index === currentIndex ? 'active' : ''}" 
                     onclick="selectFromMatrix(${index})">
                    <span class="tile-icon">${sound.icon}</span>
                    <div class="tile-title">${sound.title}</div>
                    <div class="tile-meta">${sound.duration}</div>
                </div>
            `).join('');
        }

        // Êõ¥Êñ∞Èü≥È¢ëÁü©Èòµ
        function updateAudioMatrix() {
            document.querySelectorAll('.audio-tile').forEach((tile, index) => {
                tile.classList.toggle('active', index === currentIndex);
            });
        }

        // ‰ªéÁü©ÈòµÈÄâÊã©Èü≥È¢ë
        function selectFromMatrix(index) {
            currentIndex = index;
            loadSound(index);
            
            if (isPlaying) {
                setTimeout(() => playCurrentSound(), 100);
            }
            
            setTimeout(() => {
                toggleAudioVault();
            }, 300);
        }

        // ÂàáÊç¢Èü≥È¢ëÂ∫ìÊòæÁ§∫
        function toggleAudioVault() {
            const vault = document.getElementById('audioVault');
            vault.classList.toggle('visible');
            document.body.style.cursor = vault.classList.contains('visible') ? 'default' : 'none';
        }

        // ÂàùÂßãÂåñËÆ°Êó∂Âô®
        function initTimers() {
            setInterval(() => {
                updateTimers();
            }, 1000);
        }

        // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
        function updateTimers() {
            // ÂΩìÂâçÊó∂Èó¥
            const now = new Date();
            document.getElementById('timeDisplay').textContent = 
                now.toLocaleTimeString('zh-CN', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById('dateDisplay').textContent = 
                now.toLocaleDateString('zh-CN').replace(/\//g, ' ¬∑ ');

            // Êí≠ÊîæÊó∂Èó¥
            if (isPlaying) {
                totalPlayTime++;
            }
            const hours = Math.floor(totalPlayTime / 3600);
            const minutes = Math.floor((totalPlayTime % 3600) / 60);
            const seconds = totalPlayTime % 60;
            document.getElementById('sessionTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ÂàõÂª∫Ëß¶Êë∏Ê∂üÊº™ÊïàÊûú
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple-effect';
            ripple.style.left = (x - 50) + 'px';
            ripple.style.top = (y - 50) + 'px';
            ripple.style.width = '100px';
            ripple.style.height = '100px';
            
            document.body.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        // ÊâãÂäøÊéßÂà∂ÂàùÂßãÂåñ
        function initGestures() {
            const appShell = document.querySelector('.app-shell');
            
            // Ëß¶Êë∏‰∫ã‰ª∂
            appShell.addEventListener('touchstart', handleTouchStart, { passive: false });
            appShell.addEventListener('touchmove', handleTouchMove, { passive: false });
            appShell.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            // Èº†Ê†á‰∫ã‰ª∂
            appShell.addEventListener('mousedown', handleMouseStart);
            appShell.addEventListener('mousemove', handleMouseMove);
            appShell.addEventListener('mouseup', handleMouseEnd);
            
            // Èü≥ÈáèÊéßÂà∂
            initVolumeControl();
            
            // ÂÖ≥Èó≠ÊåâÈíÆ
            document.getElementById('vaultClose').addEventListener('click', toggleAudioVault);
            
            // ÈîÆÁõòÊéßÂà∂
            document.addEventListener('keydown', handleKeyboard);
        }

        // ÂàùÂßãÂåñÈü≥ÈáèÊéßÂà∂
        function initVolumeControl() {
            const volumeRail = document.getElementById('volumeRail');
            const volumeThumb = document.getElementById('volumeThumb');
            
            let isDragging = false;
            
            function handleVolumeStart(e) {
                isDragging = true;
                e.preventDefault();
            }
            
            function handleVolumeMove(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                const rect = volumeRail.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const newVolume = Math.max(0, Math.min(100, (x / rect.width) * 100));
                setVolume(newVolume);
            }
            
            function handleVolumeEnd() {
                isDragging = false;
            }
            
            // Èº†Ê†á‰∫ã‰ª∂
            volumeThumb.addEventListener('mousedown', handleVolumeStart);
            document.addEventListener('mousemove', handleVolumeMove);
            document.addEventListener('mouseup', handleVolumeEnd);
            
            // Ëß¶Êë∏‰∫ã‰ª∂
            volumeThumb.addEventListener('touchstart', handleVolumeStart);
            document.addEventListener('touchmove', handleVolumeMove);
            document.addEventListener('touchend', handleVolumeEnd);
            
            // ËΩ®ÈÅìÁÇπÂáª
            volumeRail.addEventListener('click', (e) => {
                const rect = volumeRail.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const newVolume = (x / rect.width) * 100;
                setVolume(newVolume);
            });
            
            // ÂàùÂßãÂåñ‰ΩçÁΩÆ
            updateVolumeDisplay();
        }

        function handleTouchStart(e) {
            if (e.target.closest('.control-dock') || e.target.closest('.audio-vault')) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            touchStartPos = { x: touch.clientX, y: touch.clientY, time: Date.now() };
            
            createRipple(touch.clientX, touch.clientY);
            
            // ÈïøÊåâÊ£ÄÊµã
            longPressTimer = setTimeout(() => {
                // ÈïøÊåâÂäüËÉΩ
                if (navigator.vibrate) navigator.vibrate(50);
            }, 800);
        }

        function handleTouchMove(e) {
            if (!touchStartPos) return;
            
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartPos.x;
            const deltaY = touch.clientY - touchStartPos.y;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            if (distance > 20) {
                clearTimeout(longPressTimer);
            }
        }

        function handleTouchEnd(e) {
            if (!touchStartPos) return;
            
            clearTimeout(longPressTimer);
            
            const touch = e.changedTouches[0];
            const deltaX = touch.clientX - touchStartPos.x;
            const deltaY = touch.clientY - touchStartPos.y;
            const duration = Date.now() - touchStartPos.time;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            if (duration < 300 && distance < 30) {
                // ÁÇπÂáªÊ£ÄÊµã
                tapCount++;
                
                if (tapCount === 1) {
                    tapTimer = setTimeout(() => {
                        // ÂçïÂáª
                        togglePlay();
                        tapCount = 0;
                    }, 300);
                } else if (tapCount === 2) {
                    // ÂèåÂáª
                    clearTimeout(tapTimer);
                    toggleAudioVault();
                    tapCount = 0;
                }
            } else if (distance > 50) {
                // ÊªëÂä®ÊâãÂäø
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Ê∞¥Âπ≥ÊªëÂä®
                    switchSound(deltaX > 0 ? 1 : -1);
                }
            }
            
            touchStartPos = null;
        }

        function handleMouseStart(e) {
            if (e.target.closest('.control-dock') || e.target.closest('.audio-vault')) return;
            
            touchStartPos = { x: e.clientX, y: e.clientY, time: Date.now() };
            createRipple(e.clientX, e.clientY);
        }

        function handleMouseMove(e) {
            // ÂèØ‰ª•Ê∑ªÂä†Èº†Ê†áÁßªÂä®ÁöÑËßÜËßâÂèçÈ¶à
        }

        function handleMouseEnd(e) {
            if (!touchStartPos) return;
            
            const duration = Date.now() - touchStartPos.time;
            const distance = Math.sqrt(
                Math.pow(e.clientX - touchStartPos.x, 2) + 
                Math.pow(e.clientY - touchStartPos.y, 2)
            );
            
            if (duration < 300 && distance < 30) {
                tapCount++;
                
                if (tapCount === 1) {
                    tapTimer = setTimeout(() => {
                        togglePlay();
                        tapCount = 0;
                    }, 300);
                } else if (tapCount === 2) {
                    clearTimeout(tapTimer);
                    toggleAudioVault();
                    tapCount = 0;
                }
            }
            
            touchStartPos = null;
        }

        function handleKeyboard(e) {
            switch (e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'ArrowLeft':
                    switchSound(-1);
                    break;
                case 'ArrowRight':
                    switchSound(1);
                    break;
                case 'KeyL':
                    toggleAudioVault();
                    break;
                case 'Escape':
                    document.getElementById('audioVault').classList.remove('visible');
                    document.body.style.cursor = 'none';
                    break;
            }
        }

        // Èü≥È¢ëÂèØËßÜÂåñ
        function startVisualization() {
            function animate() {
                if (!canvas || !ctx) return;
                
                const rect = canvas.getBoundingClientRect();
                ctx.clearRect(0, 0, rect.width, rect.height);
                
                if (isPlaying && analyser && dataArray) {
                    analyser.getByteFrequencyData(dataArray);
                    drawVisualization(rect.width, rect.height);
                }
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }

        function drawVisualization(width, height) {
            const centerX = width / 2;
            const centerY = height / 2;
            
            // ÁªòÂà∂È¢ëË∞±ÁéØ
            for (let i = 0; i < dataArray.length; i++) {
                const angle = (i / dataArray.length) * Math.PI * 2;
                const amplitude = dataArray[i] / 255;
                const radius = 50 + amplitude * 30;
                
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.arc(x, y, 1 + amplitude * 2, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(0, 102, 255, ${0.3 + amplitude * 0.4})`;
                ctx.shadowBlur = 8;
                ctx.shadowColor = '#0066FF';
                ctx.fill();
            }
        }

        // ÂêØÂä®Â∫îÁî®
        document.addEventListener('DOMContentLoaded', init);

        // È°µÈù¢ÂèØËßÅÊÄßÂ§ÑÁêÜ
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            } else {
                startVisualization();
            }
        });
    </script>
</body>
</html>