<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘æ’­æ”¾æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .volume-control {
            margin: 10px 0;
        }
        #log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸµ éŸ³é¢‘æ’­æ”¾æµ‹è¯•</h1>
    
    <div class="test-item">
        <h3>1. åŸºç¡€HTML5éŸ³é¢‘æµ‹è¯•</h3>
        <audio controls preload="metadata">
            <source src="./audio/rain.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>
        <p>è¯·ç‚¹å‡»ä¸Šæ–¹æ’­æ”¾å™¨çš„æ’­æ”¾æŒ‰é’®æµ‹è¯•éŸ³é¢‘æ˜¯å¦æ­£å¸¸ã€‚</p>
    </div>

    <div class="test-item">
        <h3>2. JavaScriptéŸ³é¢‘å¯¹è±¡æµ‹è¯•</h3>
        <div class="volume-control">
            <label>éŸ³é‡: </label>
            <input type="range" id="volume" min="0" max="100" value="50">
            <span id="volumeValue">50%</span>
        </div>
        <button onclick="playJSAudio()">æ’­æ”¾é›¨å£°</button>
        <button onclick="stopJSAudio()">åœæ­¢</button>
        <button onclick="playMultiple()">æ’­æ”¾å¤šä¸ªéŸ³é¢‘</button>
        <button onclick="stopAll()">åœæ­¢å…¨éƒ¨</button>
        <div id="jsAudioStatus" class="status info">å‡†å¤‡å°±ç»ª</div>
    </div>

    <div class="test-item">
        <h3>3. æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥</h3>
        <div id="compatibility"></div>
    </div>

    <div class="test-item">
        <h3>4. éŸ³é¢‘æ–‡ä»¶æ£€æŸ¥</h3>
        <button onclick="checkAudioFiles()">æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶</button>
        <div id="audioFilesStatus"></div>
    </div>

    <div class="test-item">
        <h3>5. è°ƒè¯•æ—¥å¿—</h3>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log"></div>
    </div>

    <script>
        let audioElements = new Map();
        let currentVolume = 50;

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logEntry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(id, message, type = 'info') {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
            }
        }

        // éŸ³é‡æ§åˆ¶
        document.getElementById('volume').addEventListener('input', function() {
            currentVolume = this.value;
            document.getElementById('volumeValue').textContent = this.value + '%';
            
            // æ›´æ–°æ‰€æœ‰éŸ³é¢‘å…ƒç´ çš„éŸ³é‡
            audioElements.forEach(audio => {
                audio.volume = currentVolume / 100;
            });
        });

        // æ’­æ”¾å•ä¸ªéŸ³é¢‘
        async function playJSAudio() {
            try {
                updateStatus('jsAudioStatus', 'æ­£åœ¨åŠ è½½éŸ³é¢‘...', 'info');
                log('å¼€å§‹æ’­æ”¾é›¨å£°éŸ³é¢‘');
                
                if (!audioElements.has('rain')) {
                    const audio = new Audio('./audio/rain.mp3');
                    audio.loop = true;
                    audio.volume = currentVolume / 100;
                    
                    audio.onloadstart = () => log('éŸ³é¢‘å¼€å§‹åŠ è½½');
                    audio.oncanplay = () => log('éŸ³é¢‘å¯ä»¥æ’­æ”¾');
                    audio.onplay = () => log('éŸ³é¢‘å¼€å§‹æ’­æ”¾');
                    audio.onpause = () => log('éŸ³é¢‘æš‚åœ');
                    audio.onerror = (e) => {
                        log(`éŸ³é¢‘é”™è¯¯: ${e.target.error?.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                        updateStatus('jsAudioStatus', 'éŸ³é¢‘åŠ è½½å¤±è´¥', 'error');
                    };
                    
                    audioElements.set('rain', audio);
                }
                
                const audio = audioElements.get('rain');
                await audio.play();
                updateStatus('jsAudioStatus', 'æ­£åœ¨æ’­æ”¾é›¨å£°...', 'success');
                log('é›¨å£°æ’­æ”¾æˆåŠŸ', 'success');
                
            } catch (error) {
                log(`æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
                updateStatus('jsAudioStatus', `æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åœæ­¢éŸ³é¢‘
        function stopJSAudio() {
            if (audioElements.has('rain')) {
                const audio = audioElements.get('rain');
                audio.pause();
                audio.currentTime = 0;
                updateStatus('jsAudioStatus', 'å·²åœæ­¢æ’­æ”¾', 'info');
                log('åœæ­¢æ’­æ”¾é›¨å£°');
            }
        }

        // æ’­æ”¾å¤šä¸ªéŸ³é¢‘
        async function playMultiple() {
            try {
                updateStatus('jsAudioStatus', 'æ­£åœ¨æ’­æ”¾å¤šä¸ªéŸ³é¢‘...', 'info');
                log('å¼€å§‹æ’­æ”¾å¤šä¸ªéŸ³é¢‘');
                
                const audioFiles = [
                    { id: 'rain', url: './audio/rain.mp3', name: 'é›¨å£°' },
                    { id: 'ocean', url: './audio/ocean_waves.mp3', name: 'æµ·æµª' },
                    { id: 'white_noise', url: './audio/white_noise.mp3', name: 'ç™½å™ªéŸ³' }
                ];
                
                const promises = audioFiles.map(async (file) => {
                    try {
                        if (!audioElements.has(file.id)) {
                            const audio = new Audio(file.url);
                            audio.loop = true;
                            audio.volume = currentVolume / 100;
                            audioElements.set(file.id, audio);
                            log(`åˆ›å»ºéŸ³é¢‘å¯¹è±¡: ${file.name}`);
                        }
                        
                        const audio = audioElements.get(file.id);
                        await audio.play();
                        log(`æˆåŠŸæ’­æ”¾: ${file.name}`, 'success');
                        return { success: true, name: file.name };
                    } catch (error) {
                        log(`æ’­æ”¾å¤±è´¥ ${file.name}: ${error.message}`, 'error');
                        return { success: false, name: file.name, error };
                    }
                });
                
                const results = await Promise.allSettled(promises);
                const successful = results.filter(r => r.status === 'fulfilled' && r.value.success).length;
                
                updateStatus('jsAudioStatus', `æ’­æ”¾äº† ${successful}/${audioFiles.length} ä¸ªéŸ³é¢‘`, 
                    successful > 0 ? 'success' : 'error');
                    
            } catch (error) {
                log(`æ‰¹é‡æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
                updateStatus('jsAudioStatus', `æ‰¹é‡æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åœæ­¢å…¨éƒ¨
        function stopAll() {
            audioElements.forEach((audio, id) => {
                audio.pause();
                audio.currentTime = 0;
                log(`åœæ­¢æ’­æ”¾: ${id}`);
            });
            updateStatus('jsAudioStatus', 'å·²åœæ­¢æ‰€æœ‰éŸ³é¢‘', 'info');
        }

        // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
        function checkCompatibility() {
            const compatDiv = document.getElementById('compatibility');
            let html = '<ul>';
            
            // Audio API support
            html += `<li>Audio API: ${typeof Audio !== 'undefined' ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</li>`;
            
            // MP3 support
            const audio = new Audio();
            const mp3Support = audio.canPlayType('audio/mpeg');
            html += `<li>MP3 æ”¯æŒ: ${mp3Support ? 'âœ… ' + mp3Support : 'âŒ ä¸æ”¯æŒ'}</li>`;
            
            // User gesture requirement
            html += `<li>ç”¨æˆ·æ‰‹åŠ¿è¦æ±‚: ç°ä»£æµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾éŸ³é¢‘</li>`;
            
            // Volume control
            html += `<li>éŸ³é‡æ§åˆ¶: ${typeof audio.volume !== 'undefined' ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</li>`;
            
            // CORS
            html += `<li>è·¨åŸŸæ”¯æŒ: éœ€è¦æ­£ç¡®çš„æœåŠ¡å™¨é…ç½®</li>`;
            
            html += '</ul>';
            compatDiv.innerHTML = html;
        }

        // æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶
        async function checkAudioFiles() {
            const statusDiv = document.getElementById('audioFilesStatus');
            statusDiv.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶...</p>';
            
            const audioFiles = [
                'rain.mp3', 'ocean_waves.mp3', 'white_noise.mp3', 
                'birds_chirping.mp3', 'fireplace.mp3'
            ];
            
            let html = '<ul>';
            
            for (const file of audioFiles) {
                try {
                    const response = await fetch(`./audio/${file}`, { method: 'HEAD' });
                    const size = response.headers.get('content-length');
                    const sizeKB = size ? Math.round(size / 1024) : 'æœªçŸ¥';
                    
                    if (response.ok) {
                        html += `<li>âœ… ${file} (${sizeKB} KB)</li>`;
                        log(`æ–‡ä»¶æ£€æŸ¥æˆåŠŸ: ${file} (${sizeKB} KB)`, 'success');
                    } else {
                        html += `<li>âŒ ${file} - HTTP ${response.status}</li>`;
                        log(`æ–‡ä»¶æ£€æŸ¥å¤±è´¥: ${file} - HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    html += `<li>âŒ ${file} - ${error.message}</li>`;
                    log(`æ–‡ä»¶æ£€æŸ¥é”™è¯¯: ${file} - ${error.message}`, 'error');
                }
            }
            
            html += '</ul>';
            statusDiv.innerHTML = html;
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥å…¼å®¹æ€§
        window.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            checkCompatibility();
            
            // æ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç»ä¸é¡µé¢äº¤äº’
            let hasInteracted = false;
            const updateInteractionStatus = () => {
                if (!hasInteracted) {
                    hasInteracted = true;
                    log('ç”¨æˆ·å·²ä¸é¡µé¢äº¤äº’ï¼ŒéŸ³é¢‘æ’­æ”¾æƒé™å·²æ¿€æ´»', 'success');
                }
            };
            
            document.addEventListener('click', updateInteractionStatus, { once: true });
            document.addEventListener('touchstart', updateInteractionStatus, { once: true });
            document.addEventListener('keydown', updateInteractionStatus, { once: true });
        });
    </script>
</body>
</html>